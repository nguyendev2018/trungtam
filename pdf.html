<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Viewer with Zoom and Pan</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #controls {
            margin-bottom: 10px;
        }
        button {
            margin-right: 10px;
        }
        #pdf-container {
            width: 100%;
            max-width: 80%;
            height: 700px;
            margin: auto;
            overflow: hidden;
            /* border: 1px solid #ccc; */
            position: relative;
            cursor: grab;
        }
        canvas {
            display: block;
            width: 100%;
            height: auto;
            transform-origin: top left;
            transition: transform 0.3s ease-in-out; /* Mượt mà khi zoom */
        }
        #pdf-container.dragging {
            cursor: grabbing;
        }
        input[type="number"] {
            text-align: center;
        }
    </style>
</head>
<body>

    <div id="controls">
        <button id="prev-page">Previous Page</button>
        <button id="next-page">Next Page</button>
        <button id="zoom-in">Zoom In</button>
        <button id="zoom-out">Zoom Out</button>
        <button id="download-pdf">Download PDF</button>
    </div>

    <div id="pdf-container">
        <canvas id="pdf-render"></canvas>
    </div>

    <p>
        Page: 
        <input type="number" id="page-input" value="1" min="1" style="width: 50px;"> 
        / <span id="page-count"></span>
    </p>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
    <script>
        const url = '/6000eeaf-42f5-49f4-b218-c6d5abf7e037.pdf';  // Đường dẫn đến file PDF

        let pdfDoc = null,
            pageNum = 1,
            pageIsRendering = false,
            pageNumIsPending = null;

        let scale = 1;  // Giá trị phóng to ban đầu
        const canvas = document.getElementById('pdf-render'),
              ctx = canvas.getContext('2d');

        const pdfContainer = document.getElementById('pdf-container');
        let isDragging = false;
        let startX, startY, scrollLeft, scrollTop;

        // Render trang PDF
        const renderPage = num => {
            pageIsRendering = true;

            // Lấy trang PDF
            pdfDoc.getPage(num).then(page => {
                const viewport = page.getViewport({ scale: scale * window.devicePixelRatio });  // Render với scale lớn hơn và DPI cao hơn

                // Đặt kích thước canvas gốc dựa trên trang PDF
                canvas.width = viewport.width;
                canvas.height = viewport.height;

                // Đặt lại style để hiển thị đúng kích thước
                canvas.style.width = `${viewport.width / window.devicePixelRatio}px`;
                canvas.style.height = `${viewport.height / window.devicePixelRatio}px`;

                const renderCtx = {
                    canvasContext: ctx,
                    viewport
                };

                page.render(renderCtx).promise.then(() => {
                    pageIsRendering = false;

                    if (pageNumIsPending !== null) {
                        renderPage(pageNumIsPending);
                        pageNumIsPending = null;
                    }
                });

                // Cập nhật số trang hiện tại
                document.getElementById('page-input').value = num;
            });
        };

        // Đợi để render trang tiếp theo
        const queueRenderPage = num => {
            if (pageIsRendering) {
                pageNumIsPending = num;
            } else {
                renderPage(num);
            }
        };

        // Hiển thị trang trước
        const showPrevPage = () => {
            if (pageNum <= 1) {
                return;
            }
            pageNum--;
            queueRenderPage(pageNum);
        };

        // Hiển thị trang tiếp theo
        const showNextPage = () => {
            if (pageNum >= pdfDoc.numPages) {
                return;
            }
            pageNum++;
            queueRenderPage(pageNum);
        };

        // Phóng to (sử dụng scale lớn hơn và render lại)
        const zoomIn = () => {
            if (scale < 3) {  // Giới hạn mức zoom tối đa
                scale += 0.2;
                queueRenderPage(pageNum);  // Render lại trang với scale mới
            }
        };

        // Thu nhỏ (sử dụng scale nhỏ hơn và render lại)
        const zoomOut = () => {
            if (scale > 0.5) {  // Giới hạn mức zoom tối thiểu
                scale -= 0.2;
                queueRenderPage(pageNum);  // Render lại trang với scale mới
            }
        };

        // Chuyển đến trang từ input
        const goToPage = () => {
            const pageNumInput = parseInt(document.getElementById('page-input').value);
            if (pageNumInput >= 1 && pageNumInput <= pdfDoc.numPages) {
                pageNum = pageNumInput;
                queueRenderPage(pageNum);
            } else {
                alert('Invalid page number');
            }
        };

        // Tải xuống PDF
        const downloadPDF = () => {
            const a = document.createElement('a');
            a.href = url;  // Đường dẫn đến file PDF
            a.download = 'downloaded-pdf.pdf';  // Tên file khi tải xuống
            a.click();  // Kích hoạt tải xuống
        };

        // Kéo để di chuyển khi zoom
        pdfContainer.addEventListener('mousedown', (e) => {
            isDragging = true;
            pdfContainer.classList.add('dragging');
            startX = e.pageX - pdfContainer.offsetLeft;
            startY = e.pageY - pdfContainer.offsetTop;
            scrollLeft = pdfContainer.scrollLeft;
            scrollTop = pdfContainer.scrollTop;
        });

        pdfContainer.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
            const x = e.pageX - pdfContainer.offsetLeft;
            const y = e.pageY - pdfContainer.offsetTop;
            const walkX = (x - startX) * 1.5;
            const walkY = (y - startY) * 1.5;
            pdfContainer.scrollLeft = scrollLeft - walkX;
            pdfContainer.scrollTop = scrollTop - walkY;
        });

        pdfContainer.addEventListener('mouseup', () => {
            isDragging = false;
            pdfContainer.classList.remove('dragging');
        });

        pdfContainer.addEventListener('mouseleave', () => {
            isDragging = false;
            pdfContainer.classList.remove('dragging');
        });

        // Lấy tài liệu PDF
        pdfjsLib.getDocument(url).promise.then(pdfDoc_ => {
            pdfDoc = pdfDoc_;

            document.getElementById('page-count').textContent = pdfDoc.numPages;

            renderPage(pageNum);
        });

        // Gán sự kiện cho các nút
        document.getElementById('prev-page').addEventListener('click', showPrevPage);
        document.getElementById('next-page').addEventListener('click', showNextPage);
        document.getElementById('zoom-in').addEventListener('click', zoomIn);
        document.getElementById('zoom-out').addEventListener('click', zoomOut);
        document.getElementById('page-input').addEventListener('change', goToPage);

        // Sự kiện cho nút Download
        document.getElementById('download-pdf').addEventListener('click', downloadPDF);

    </script>
<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body>
</html>
